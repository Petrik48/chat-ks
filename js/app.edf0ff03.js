(function(){"use strict";var e={1905:function(e,t,s){var r=s(8935),a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("v-main-wrapper")],1)},n=[],i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"v-main-wrapper"},[s("router-view")],1)},o=[],u=s(4665),l={name:"v-main-wrapper",components:{},props:{},data(){return{}},computed:{},methods:{...(0,u.nv)(["FETCH_USERS"])},mounted(){this.FETCH_USERS()}},c=l,m=s(1001),d=(0,m.Z)(c,i,o,!1,null,"4b5c46dd",null),p=d.exports,v={name:"App",components:{VMainWrapper:p}},_=v,h=(0,m.Z)(_,a,n,!1,null,null,null),g=h.exports,f=s(6166),E=s.n(f);r.Z.use(u.ZP);let S=new u.ZP.Store({state:{users:[],dialogs:[],messages:[],activeUserId:0,activeUserName:"",receiverName:""},getters:{},mutations:{SET_USERS_TO_STORE(e,t){e.users=t},LOGIN_USER(e,t){e.activeUserId=t.id,e.activeUserName=t.name+" "+t.second_name},FETCH_DIALOGS(e,t){e.dialogs=t},LOGOUT_USER(e){({users:[],messages:[],activeUserId:0,activeUserName:"",receiverName:""})},ADD_MESSAGES_TO_STATE(e,t){e.messages=t,console.log(t)},ADD_RECEIVER_NAME(e,t){e.receiverName=t},initialiseStore(e){localStorage.getItem("store")&&this.replaceState(Object.assign(e,JSON.parse(localStorage.getItem("store"))))}},actions:{FETCH_USERS({commit:e}){return E().get("http://localhost:3000/users").then((t=>{e("SET_USERS_TO_STORE",t.data)}))},REGISTER_USER({dispatch:e,commit:t},s){E().post("http://localhost:3000/users/",s),e("FETCH_USERS")},LOGIN_USER({commit:e},t){e("LOGIN_USER",t)},LOGOUT_USER({commit:e}){e("LOGOUT_USER"),localStorage.clear()},FETCH_MESSAGES({commit:e},t){E().get("http://localhost:3000/messages/").then((s=>{e("ADD_MESSAGES_TO_STATE",s.data.filter((e=>e.sender_id===this.state.activeUserId&&e.recipient_id===t||e.sender_id===t&&e.recipient_id===this.state.activeUserId)))}))},FETCH_RECEIVER_NAME({commit:e},t){e("ADD_RECEIVER_NAME",t)},SEND_MESSAGE_TO_CHAT({dispatch:e,commit:t},s){E().get("http://localhost:3000/messages/").then((e=>{let t=e.data.length+1,r={id:t,text:s.text,sender_id:this.state.activeUserId,recipient_id:Number(s.id),message_time:(new Date).toLocaleTimeString("en-US",{hour12:!1,hour:"numeric",minute:"numeric"})};return this.state.messages.push(r),E().post("http://localhost:3000/messages/",r)}))}}});S.subscribe(((e,t)=>{localStorage.setItem("store",JSON.stringify(t))}));var C=S,N=s(2809),U=function(){var e=this,t=this,s=t.$createElement,r=t._self._c||s;return r("div",{staticClass:"v-users-list"},[r("v-users-list-header",{attrs:{current_user:this.activeUserName}}),r("ul",{staticClass:"v-users"},t._l(t.users.filter((function(t){return t.id!==e.activeUserId})),(function(e){return r("p",{key:e.id,staticClass:"v-user",on:{click:function(s){return t.toChat(e)}}},[t._v(t._s(e.name+" "+e.second_name))])})),0),r("v-users-footer")],1)},T=[],w=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"v-users-list-header"},[s("p",{staticClass:"header__name"},[e._v(e._s(e.current_user))]),s("button",{staticClass:"header__exit-button",on:{click:this.logout}},[s("i",{staticClass:"material-icons",staticStyle:{color:"white"}},[e._v("logout")])])])},O=[],R={name:"v-users-list-header",props:{current_user:{type:String,default:()=>""}},data(){return{}},computed:{},methods:{...(0,u.nv)(["LOGOUT_USER"]),logout(){this.LOGOUT_USER(),this.$router.push({name:"login"})}}},x=R,b=(0,m.Z)(x,w,O,!1,null,"2ad19ee6",null),y=b.exports,I=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},L=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"v-users-footer"},[s("ul",{staticClass:"pages"},[s("li",{staticClass:"active"},[e._v("1")]),s("li",[e._v("2")])])])}],A={name:"v-users-footer",props:{},data(){return{}},computed:{}},P=A,k=(0,m.Z)(P,I,L,!1,null,"36685ce2",null),G=k.exports,M={name:"v-users-list",components:{VUsersFooter:G,VUsersListHeader:y},props:{},data(){return{}},computed:{...(0,u.rn)(["dialogs","users","activeUserId","activeUserName"])},methods:{...(0,u.nv)(["FETCH_MESSAGES","FETCH_RECEIVER_NAME"]),toChat(e){this.$router.push({name:"chat",query:{user_id:e.id},params:{id:e.id}}),this.FETCH_MESSAGES(e.id),this.FETCH_RECEIVER_NAME(e.name+" "+e.second_name)}},mounted(){}},$=M,H=(0,m.Z)($,U,T,!1,null,"08b7296a",null),Z=H.exports,D=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("form",{staticClass:"v-auth",on:{submit:function(t){return t.preventDefault(),e.login.apply(null,arguments)}}},[s("h5",{staticClass:"v-auth__title"},[e._v("Тут могла быть ваша реклама")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.userLogin,expression:"userLogin"}],staticClass:"v-auth__input",attrs:{type:"text",placeholder:"Логин"},domProps:{value:e.userLogin},on:{input:function(t){t.target.composing||(e.userLogin=t.target.value)}}}),s("input",{directives:[{name:"model",rawName:"v-model",value:e.userPassword,expression:"userPassword"}],staticClass:"v-auth__input",attrs:{type:"password",placeholder:"Пароль"},domProps:{value:e.userPassword},on:{input:function(t){t.target.composing||(e.userPassword=t.target.value)}}}),s("router-link",{staticClass:"v-auth__link",attrs:{to:{name:"registration"}}},[e._v("Регистрация")]),s("button",{staticClass:"v-auth__button"},[e._v("Войти")])],1)},F=[],V={name:"v-login",props:{},data(){return{userLogin:"",userPassword:""}},computed:{...(0,u.rn)(["users"])},methods:{...(0,u.nv)(["LOGIN_USER"]),login(){this.users.find((e=>{e.login===this.userLogin&&e.password===this.userPassword&&(this.$router.push({name:"users"}),this.LOGIN_USER(e))}))}}},j=V,q=(0,m.Z)(j,D,F,!1,null,null,null),B=q.exports,J=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("form",{staticClass:"v-auth",on:{submit:function(t){return t.preventDefault(),e.registerUser.apply(null,arguments)}}},[s("h5",{staticClass:"v-auth__title"},[e._v("Тут могла быть ваша реклама")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.userLogin,expression:"userLogin"}],staticClass:"v-auth__input",attrs:{type:"text",placeholder:"Придумайте логин"},domProps:{value:e.userLogin},on:{input:function(t){t.target.composing||(e.userLogin=t.target.value)}}}),s("input",{directives:[{name:"model",rawName:"v-model",value:e.userName,expression:"userName"}],staticClass:"v-auth__input",attrs:{type:"text",placeholder:"Введите ваше имя"},domProps:{value:e.userName},on:{input:function(t){t.target.composing||(e.userName=t.target.value)}}}),s("input",{directives:[{name:"model",rawName:"v-model",value:e.userSecondName,expression:"userSecondName"}],staticClass:"v-auth__input",attrs:{type:"text",placeholder:"Введите вашу фамилию"},domProps:{value:e.userSecondName},on:{input:function(t){t.target.composing||(e.userSecondName=t.target.value)}}}),s("input",{directives:[{name:"model",rawName:"v-model",value:e.userPassword,expression:"userPassword"}],staticClass:"v-auth__input",attrs:{type:"password",placeholder:"Придумайте пароль"},domProps:{value:e.userPassword},on:{input:function(t){t.target.composing||(e.userPassword=t.target.value)}}}),s("button",{staticClass:"v-auth__button"},[e._v("Регистрация")])])},W=[],z={name:"v-registration",props:{},data(){return{userLogin:"",userName:"",userSecondName:"",userPassword:""}},computed:{...(0,u.rn)(["users"])},methods:{...(0,u.nv)(["REGISTER_USER","FETCH_USERS"]),registerUser(){let e={id:this.users.length+1,login:this.userLogin,name:this.userName,second_name:this.userSecondName,password:this.userPassword};this.REGISTER_USER(e).then((()=>{this.$router.push({name:"login"}),this.FETCH_USERS()}))}}},K=z,Q=(0,m.Z)(K,J,W,!1,null,"6cc8b7a6",null),X=Q.exports,Y=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"v-chat"},[s("div",{staticClass:"top"},[s("i",{staticClass:"material-icons",on:{click:this.goBack}},[e._v("arrow_back")]),s("p",[e._v(e._s(this.receiverName))])]),s("div",{staticClass:"chat"},e._l(this.messages,(function(e){return s("v-message",{key:e.id,attrs:{message_data:e}})})),1),s("form",{staticClass:"bottom",attrs:{action:""},on:{submit:function(t){return t.preventDefault(),e.sendMessage.apply(null,arguments)},keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMessage.apply(null,arguments)}}},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.text,expression:"text"}],domProps:{value:e.text},on:{input:function(t){t.target.composing||(e.text=t.target.value)}}}),e._m(0)])])},ee=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("button",[s("i",{staticClass:"material-icons"},[e._v("send")])])}],te=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"v-message"},[s("p",{class:e.className},[e._v(" "+e._s(this.message_data.text)+" ")])])},se=[],re={name:"v-message",props:{message_data:{type:Object,default:()=>{}}},data(){return{}},computed:{...(0,u.rn)(["activeUserId"]),className(){return{from:this.message_data.sender_id!==this.activeUserId}}}},ae=re,ne=(0,m.Z)(ae,te,se,!1,null,"57be52f6",null),ie=ne.exports,oe={name:"v-chat",components:{VMessage:ie},props:{id:{type:Number,default:()=>{}}},data(){return{user_id:this.$route.query.user_id,text:""}},computed:{...(0,u.rn)(["messages","receiverName"])},methods:{...(0,u.nv)(["SEND_MESSAGE_TO_CHAT"]),goBack(){this.$router.go(-1)},sendMessage(){this.SEND_MESSAGE_TO_CHAT({text:this.text,id:this.user_id}),this.text=""}}},ue=oe,le=(0,m.Z)(ue,Y,ee,!1,null,"9beccaea",null),ce=le.exports;r.Z.use(N.Z);let me=new N.Z({mode:"history",routes:[{path:"/",name:"login",component:B},{path:"/users/",name:"users",component:Z},{path:"/registration/",name:"registration",component:X},{path:"/chat/",name:"chat",component:ce,props:!0}]});var de=me;r.Z.config.productionTip=!1,new r.Z({render:e=>e(g),store:C,router:de,beforeCreate(){this.$store.commit("initialiseStore")}}).$mount("#app")}},t={};function s(r){var a=t[r];if(void 0!==a)return a.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,s),n.exports}s.m=e,function(){var e=[];s.O=function(t,r,a,n){if(!r){var i=1/0;for(c=0;c<e.length;c++){r=e[c][0],a=e[c][1],n=e[c][2];for(var o=!0,u=0;u<r.length;u++)(!1&n||i>=n)&&Object.keys(s.O).every((function(e){return s.O[e](r[u])}))?r.splice(u--,1):(o=!1,n<i&&(i=n));if(o){e.splice(c--,1);var l=a();void 0!==l&&(t=l)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[r,a,n]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,r){var a,n,i=r[0],o=r[1],u=r[2],l=0;if(i.some((function(t){return 0!==e[t]}))){for(a in o)s.o(o,a)&&(s.m[a]=o[a]);if(u)var c=u(s)}for(t&&t(r);l<i.length;l++)n=i[l],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(c)},r=self["webpackChunkchat_ks"]=self["webpackChunkchat_ks"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=s.O(void 0,[998],(function(){return s(1905)}));r=s.O(r)})();
//# sourceMappingURL=app.edf0ff03.js.map